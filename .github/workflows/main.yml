name: CERN Data Analysis Pipeline

on:
  push:
    branches:
      - main
      - master
  workflow_dispatch:

jobs:
  analyze_and_deploy:
    runs-on: ubuntu-latest
    
    env:
      CACHE_KEY: cern-opendata-root-v1

    steps:
      - name: 1. Checkout Repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
              
      - name: 2. Set up Python Environment
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: 3. Install Python Dependencies
        run: |
          pip install -r requirements.txt
              
      - name: 4. Restore/Download Data Cache (The Key Step!) üíæ
        uses: actions/cache@v4
        id: cache-data
        with:
          path: data
          key: ${{ runner.os }}-${{ env.CACHE_KEY }}

      - name: 5. Execute Data Analysis (Python)
        run: |
          echo "Starting analysis. This will download files only on first run."
          python analysis.py
              
      - name: 6. Prepare Results (Merge Artifacts)
        run: |
           cp -r results/* docs/
                 
      - name: 7. Upload Results as Artifact ‚¨ÜÔ∏è
        uses: actions/upload-artifact@v4
        with:
          name: analysis-results
          path: docs/

      - name: 8. Deploy to GitHub Pages
        if: ${{ github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master' }}
        uses: peaceiris/actions-gh-pages@v3
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: docs
          
      # El error estaba aqu√≠.
      # Esta l√≠nea (65) debe tener 6 espacios al inicio.
      - name: 9. Final Setup for GitHub Pages Service
        # Esta l√≠nea (66) debe tener 8 espacios al inicio.
        run: echo "REMINDER: Set GitHub Pages source to 'gh-pages' or 'docs' folder."
